CREATE OR REPLACE procedure Data_Master (p_company in varchar2, p_year in number,
                                           p_month in varchar2, p_com in number ,
										   p_card in varchar2,  p_wholiday in varchar2,
										   p_secrete   in varchar2, p_section in varchar2,
										   p_line  in varchar2, p_shift in varchar2,
										   p_otorg in varchar2)

 is


 v_totalcnt  number;
 v_wholiday  varchar2(15);
 vv_wholiday varchar2(15);
 v_gholiday  number;

 v_start     date;
 v_end       date;

 v_joinyear  number;
 v_joinmonth varchar2(15);
 v_resgyear  number;
 v_resgmonth varchar2(15);

 v_personal  number;

 v_genday    number;
 v_conday    number;

 v_othr      number:= 0;
 v_othrpart  number:= 0;
 v_status    varchar2(3);
 v_remark    varchar2(15);


 v_hr        number:= 0;
 v_min       number:= 0;

 v_leave     varchar2(20);
 vv_cnt      number;

 v_absent    varchar2(3);
 vv_absent   varchar2(3);


 p_join_date    date;
 p_resign_date  date;

begin


	begin
	select JOINING_DATE, RESIGNATION_DATE
	into   p_join_date , p_resign_date
	from   tb_personal_info
	where  company = p_company
	and    cardno  = p_card;
	exception
	when no_data_found then p_join_date    := '';
	                        p_resign_date  := '';
	when others then p_join_date    := '';
	                 p_resign_date  := '';
	end;

    v_joinyear   := to_char(p_join_date,'rrrr');
	v_joinmonth  := rtrim(to_char(p_join_date,'Month'));

 	v_resgyear   := to_char(p_resign_date,'rrrr');
 	v_resgmonth  := rtrim(to_char(p_resign_date,'Month'));

    begin
    select to_date('1-'||p_month||'-'||p_year,'dd/mm/rrrr') into v_start
    from   dual;
    exception
    when no_data_found then null;
           when others then null;
	end;

    begin
    select last_day(to_date('1-'||p_month||'-'||p_year,'dd/mm/rrrr')) into v_end
    from   dual;
    exception
    when no_data_found then null;
           when others then null;
    end;

    while (v_start <= v_end )
    loop

	   begin
	   select count(*) into v_personal
	   from   TB_DATA_MASTER_ARCV
	   where  company   = p_com
	   and    finyear   = p_year
	   and    finmonth  = p_month
	   and    sectionnm = p_section
	   and    lineno    = p_line
	   and    pdate     = v_start
	   and    cardno    = p_card;
	   exception
	   when no_data_found then v_personal := 0;
	          when others then v_personal := 0;
	   end;

    if v_personal < 1  then

	  insert into TB_DATA_MASTER_ARCV ( cardno, secreteno,   pdate     ,psatus, company , finyear , finmonth,
	                                    yes_not, sectionnm, shift, lineno , statusday)
	                           values (p_card, p_secrete , v_start,   'A', p_com , p_year , p_month,
					                      0 , p_section, p_shift, p_line , 'W.Holiday');
	  else
	  update TB_DATA_MASTER_ARCV
	  set   cardno      = p_card,
            secreteno   = p_secrete,
			pdate       =  v_start,
			intime      = '' ,
			outtime     = '',
			otstart     = '',
			duration    = '',
			latehr      = '',
			earlyhr     = '',
			otmin       = 0,
			otpart      = 0,
			latestatus  = '',
			earlystatus = '',
			company     = p_com,
			yes_not     = 0,
			isln        = 0,
			sectionnm   = p_section,
			shift       = p_shift,
			lineno      = p_line,
			finyear     = p_year,
			finmonth    = p_month,
			lateded     = 0,
			earlyded    = 0,
			othr        = 0,
			othrpart    = 0,
			psatus      = 'A',
			statusday   = 'W.Holiday'
	where  company    = p_com
    and    finyear    = p_year
    and    finmonth   = p_month
	and    sectionnm  = p_section
	and    lineno     = p_line
    and    pdate      = v_start
    and    cardno     = p_card;
	end if ;

    v_start := v_start + 1;

	end loop;
    commit;

    for c1rec in ( select b.cardno, b.secreteno, b.pdate, b.intime, b.outtime, b.otstart,
				          b.duration, b.latehr, b.earlyhr, b.otmin, b.otpart, b.latestatus,
						  b.earlystatus, b.company, b.yes_not, b.isln, b.sectionnm, b.shift,
						  b.lineno, b.finyear, b.finmonth, b.lateded, b.earlyded, b.othr,
						  b.othrpart, b.psatus, b.statusday
                   from  tb_data_master b
	               where b.company  = p_com
				   and   b.finyear  = p_year
				   and   b.finmonth = p_month
				   and   b.sectionnm= p_section
	               and   b.lineno   = p_line
				   and   b.cardno   = p_card
				   order by b.pdate asc)
   loop

   update TB_DATA_MASTER_ARCV
   set    cardno    = c1rec.cardno,
          secreteno = c1rec.secreteno,
		  pdate     = c1rec.pdate,
		  intime    = c1rec.intime ,
		  outtime   = c1rec.outtime,
		  otstart   = c1rec.otstart,
		  duration  = c1rec.duration,
		  latehr    = c1rec.latehr,
		  earlyhr   = c1rec.earlyhr,
		  otmin     = c1rec.otmin,
		  otpart    = c1rec.otpart,
		  latestatus  = c1rec.latestatus,
		  earlystatus = c1rec.earlystatus,
		  company   = c1rec.company,
		  yes_not   = c1rec.yes_not,
		  isln      = c1rec.isln,
		  sectionnm = c1rec.sectionnm,
		  shift     = c1rec.shift,
		  lineno    = c1rec.lineno,
		  finyear   = c1rec.finyear,
		  finmonth  = c1rec.finmonth,
		  lateded   = c1rec.lateded,
		  earlyded  = c1rec.earlyded,
		  othr      = c1rec.othr,
		  othrpart  = c1rec.othrpart,
		  psatus    = 'A',
		  statusday = statusday
   where  company   = p_com
   and    finyear   = p_year
   and    finmonth  = p_month
   and    sectionnm = p_section
   and    lineno    = p_line
   and    pdate     = c1rec.pdate
   and    cardno    = p_card;

   end loop;
   commit;

   for c2rec in ( select DURATION, OTMIN, OTPART, PDATE, INTIME, OUTTIME
                  from   tb_data_master_arcv
				  where  finyear   = p_year
				  and    finmonth  = p_month
				  and    company   = p_com
				  and    sectionnm = p_section
                  and    lineno    = p_line
				  and    cardno    = p_card
				  order by pdate asc)
   loop

   begin
   select count(*) into v_gholiday
   from   tb_month_generalholiday
   where  finyear   = p_year
   and    finmonth  = p_month
   and    c2rec.pdate between s_date and e_date;
   exception
   when no_data_found then v_gholiday :=0;
          when others then v_gholiday :=0;
   end;

   begin
   select count (*) into v_genday
   from   TB_MONTH_CONVERT_GENERALDAY
   where  company  = p_company
   and    finyear  = p_year
   and    finmonth = p_month
   and    WDAY     = p_wholiday
   and    c2rec.pdate between s_date and e_date;
   exception
   when no_data_found then v_genday := 0;
          when others then v_genday := 0;
   end;

   begin
   select count(*) into v_conday
   from   TB_MONTH_CONVERT_OTDAY
   where  company  = p_company
   and    finyear  = p_year
   and    finmonth = p_month
   and    c2rec.pdate between s_date and e_date;
   exception
   when no_data_found then v_conday := 0;
          when others then v_conday := 0;
   end;

   begin
   select count(*) into vv_cnt
   from   tb_leave_detailinfo
   where  company      = p_company
   and    finyear      = p_year
   and    finmonth     = p_month
   and    LEAVE_STATUS = 'Authorized'
   and    cardno       = p_card
   and    c2rec.pdate between start_date and end_date;
   exception
   when no_data_found then vv_cnt := 0;
          when others then vv_cnt := 0;
   end;

  if (c2rec.INTIME is not null or c2rec.OUTTIME is not null) then

	    if (v_gholiday > 0 and v_conday < 1) then
	        v_othr      := 0;
	        v_othrpart  := 0;
            v_status    := 'G';
            v_remark    := 'G.Holiday';

	      elsif  (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday < 1)  then

	        if p_otorg = 'N' then
			   v_othr      := 0;    v_othrpart  := 0;
			   else
		       v_othr      := round(c2rec.otmin/60);
		       v_othrpart  := round(c2rec.otpart/60);
			   end if;

			   v_status    := 'P';
			   v_remark    := 'Present';

	       elsif  (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday > 0) then

	         v_hr  := substr(c2rec.duration,1,instr(c2rec.duration,':')-1);
             v_min := substr(c2rec.duration,instr(c2rec.duration,':')+1);

				  if v_min >= 55 then
			         v_othr := v_hr + 1;
				     else
				     v_othr := v_hr;
				     end if;

					    if v_othr > 6 then
						   v_othr := v_othr - 1;
						   else
						   v_othr := v_othr;
						   end if;

	                if p_otorg = 'N' then
					   v_othrpart := 0;      v_othr     := 0;
					   else
					   v_othrpart := v_othr; v_othr     := 0;
					   end if;

					   v_status   := 'O';
					   v_remark   := 'G.Holiday Gen';

           elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday > 0) then

	                if p_otorg = 'N' then
					   v_othr      := 0;  v_othrpart  := 0;
					   else
					   v_othr      := round(c2rec.otmin/60);
					   v_othrpart  := round(c2rec.otpart/60);
					   end if;

					   v_status    := 'P';
					   v_remark    := 'W.Holiday Gen';

	         elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday < 1) then

	             v_hr  := substr(c2rec.duration,1,instr(c2rec.duration,':')-1);
                 v_min := substr(c2rec.duration,instr(c2rec.duration,':')+1);

					   if v_min >= 55 then
				          v_othr := v_hr + 1;
						  else
						  v_othr := v_hr;
						  end if;

						if v_othr > 6 then
						   v_othr := v_othr - 1;
						   else
						   v_othr := v_othr;
						   end if;

						  if p_otorg = 'N' then
							 v_othrpart := 0;       v_othr     := 0;
							 else
							 v_othrpart := v_othr;  v_othr     := 0;
							 end if;

							 v_status   := 'O';
							 v_remark   := 'W.Holiday';

			   	 else
				 v_othr      := 0;
				 v_othrpart  := 0;
				 v_status    := 'A';
				 v_remark    := 'Absent';
				 end if;


	  elsif (c2rec.INTIME is null and c2rec.OUTTIME is null) then

		  if ((v_joinyear = p_year and v_joinmonth = p_month ) or (v_resgyear = p_year and v_resgmonth = p_month)) then

		     if (p_join_date > c2rec.pdate  or p_resign_date <= c2rec.pdate) then

		         v_othr      := 0;
			     v_othrpart  := 0;
		         v_status    := 'A';
		         v_remark    := 'Absent';

			     else

				  if (v_gholiday > 0 and v_conday < 1) then
				      v_othr      := 0;
				      v_othrpart  := 0;
				      v_status    := 'G';
				      v_remark    := 'G.Holiday';

			         elsif (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday < 1) then
						 	 v_othr      := 0;
							 v_othrpart  := 0;
							 v_status    := 'A';
							 v_remark    := 'Absent';

				       elsif (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday > 0) then
							 v_othr      := 0;
							 v_othrpart  := 0;
							 v_status    := 'A';
							 v_remark    := 'G.Holiday Gen';

				       elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday > 0) then
							 v_othr      := 0;
							 v_othrpart  := 0;
							 v_status    := 'A';
							 v_remark    := 'W.Holiday Gen';

		               elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday < 1) then
							 v_othr      := 0;
							 v_othrpart  := 0;
							 v_status    := 'A';
					     v_remark   := 'W.Holiday';
				       end if;
				    end if;

		   else

			 if (v_gholiday > 0 and v_conday < 1) then
			     v_othr      := 0;
				 v_othrpart  := 0;
				 v_status    := 'G';
				 v_remark    := 'G.Holiday';

			     elsif (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday < 1) then
						 v_othr      := 0;
						 v_othrpart  := 0;
						 v_status    := 'A';
						 v_remark    := 'Absent';

					   elsif (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday > 0) then
							  v_othr      := 0;
							  v_othrpart  := 0;
							  v_status    := 'A';
							  v_remark    := 'G.Holiday Gen';

						   elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday > 0) then
								  v_othr      := 0;
								  v_othrpart  := 0;
								  v_status    := 'A';
								  v_remark    := 'W.Holiday Gen';

					          elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday < 1) then
									 v_othr      := 0;
									 v_othrpart  := 0;
									 v_status    := 'A';
								     v_remark   := 'W.Holiday';
							      end if;
	                     end if;

	else

	v_othr      := 0;
	v_othrpart  := 0;
	v_status    := 'A';
	v_remark    := 'Absent';
    end if;


    if (vv_cnt >0 and rtrim(to_char(c2rec.pdate,'Day')) = p_wholiday and v_genday > 0)then
        v_status    := 'L';
	    v_remark    := 'Leave';

	  elsif (vv_cnt > 0 and rtrim(to_char(c2rec.pdate,'Day')) = p_wholiday and v_genday < 1)then
      v_status    := 'L';
	  v_remark    := 'W.Holiday';

	  elsif (vv_cnt > 0 and rtrim(to_char(c2rec.pdate,'Day')) <> p_wholiday and v_gholiday < 1 and v_conday < 1) then
	  v_status    := 'L';
	  v_remark    := 'Leave';

	  elsif (vv_cnt > 0 and rtrim(to_char(c2rec.pdate,'Day')) <> p_wholiday and v_gholiday > 0 and v_conday < 1) then
	  v_status    := 'L';
	  v_remark    := 'G.Holiday';

	  elsif (vv_cnt > 0 and rtrim(to_char(c2rec.pdate,'Day')) <> p_wholiday and v_gholiday > 0 and v_conday > 0) then
	  v_status    := 'L';
	  v_remark    := 'G.Holiday Gen';

	  else
	  v_status    := v_status;
	  v_remark    := v_remark;
	  end if;


		update tb_data_master_arcv
		set    othr     = v_othr,
		       othrpart = v_othrpart,
		       psatus   = v_status,
			   statusday= v_remark
	    where  company  = p_com
		and    pdate    = c2rec.pdate
		and    cardno   = p_card
		and    finyear  = p_year
	    and    sectionnm= p_section
        and    lineno   = p_line
		and    finmonth = p_month;

	  end loop;
	  commit;

    /*for c4rec in ( select DURATION, OTMIN, OTPART, PDATE
                   from   tb_data_master_arcv
								   where  finyear   = p_year
								   and    finmonth  = p_month
								   and    company   = p_com
								   and    cardno    = c1rec.cardno
								   and    rtrim(to_char(pdate,'Day')) = v_wholiday
								   order by pdate asc)
   loop

				begin
				select psatus into v_absent
				from   tb_data_master_arcv
				where  company  = p_com
				and    pdate    = c4rec.pdate - 1
				and    cardno   = c1rec.cardno
				and    finyear  = p_year
				and    finmonth = p_month;
				exception
				when no_data_found then v_absent := 'A';
				       when others then v_absent := 'A';
				end;

				begin
				select psatus into vv_absent
				from   tb_data_master_arcv
				where  company  = p_com
				and    pdate    = c4rec.pdate + 1
				and    cardno   = c1rec.cardno
				and    finyear  = p_year
				and    finmonth = p_month;
				exception
				when no_data_found then v_absent := 'A';
				       when others then v_absent := 'A';
				end;


				if (v_absent = 'A' and vv_absent = 'A') then

				   update tb_data_master_arcv
				   set    statusday = 'Cut Holiday'
				   where  company  = p_com
				   and    pdate    = c4rec.pdate
				   and    cardno   = c1rec.cardno
				   and    finyear  = p_year
				   and    finmonth = p_month;

				   else
				   null;
				   end if;

     end loop;
     commit;*/

exception
 when no_data_found then null;
 when others then null;
end;
/

-----------------------
-----------------------


CREATE OR REPLACE procedure Data_Master_Temp (p_company in varchar2, p_year in number,
                                           p_month in varchar2, p_com in number ,
										   p_card in varchar2,  p_wholiday in varchar2,
										   p_secrete in varchar2, p_section in varchar2,
										   p_line  in varchar2, p_shift in varchar2,
										   p_otcom in varchar2)

 is


 v_totalcnt  number;
 v_wholiday  varchar2(15);
 vv_wholiday varchar2(15);
 v_gholiday  number;

 v_start     date;
 v_end       date;

 v_joinyear  number;
 v_joinmonth varchar2(15);
 v_resgyear  number;
 v_resgmonth varchar2(15);

 v_personal  number;

 v_genday    number;
 v_conday    number;

 v_othr      number:= 0;
 v_othrpart  number:= 0;
 v_status    varchar2(3);
 v_remark    varchar2(15);


 v_hr        number:= 0;
 v_min       number:= 0;

 v_leave     varchar2(20);
 vv_cnt      number;

 v_absent    varchar2(3);
 vv_absent   varchar2(3);

 p_join_date    date;
 p_resign_date  date;

begin


	begin
	select JOINING_DATE, RESIGNATION_DATE
	into   p_join_date , p_resign_date
	from   tb_personal_info
	where  company = p_company
	and    cardno  = p_card;
	exception
	when no_data_found then p_join_date    := '';
	                        p_resign_date  := '';
	when others then p_join_date    := '';
	                 p_resign_date  := '';
	end;

    v_joinyear   := to_char(p_join_date,'rrrr');
	v_joinmonth  := rtrim(to_char(p_join_date,'Month'));

 	v_resgyear   := to_char(p_resign_date,'rrrr');
 	v_resgmonth  := rtrim(to_char(p_resign_date,'Month'));

    begin
    select to_date('1-'||p_month||'-'||p_year,'dd/mm/rrrr') into v_start
    from   dual;
    exception
    when no_data_found then null;
           when others then null;
	end;

    begin
    select last_day(to_date('1-'||p_month||'-'||p_year,'dd/mm/rrrr')) into v_end
    from   dual;
    exception
    when no_data_found then null;
           when others then null;
    end;

    while (v_start <= v_end )
    loop

	   begin
	   select count(*) into v_personal
	   from   TB_DATA_MASTER_TEMP_ARCV
	   where  company   = p_com
	   and    finyear   = p_year
	   and    finmonth  = p_month
	   and    sectionnm = p_section
	   and    lineno    = p_line
	   and    pdate     = v_start
	   and    cardno    = p_card;
	   exception
	   when no_data_found then v_personal := 0;
	          when others then v_personal := 0;
	   end;

    if v_personal < 1  then

	  insert into TB_DATA_MASTER_TEMP_ARCV ( cardno, secreteno,   pdate     ,psatus, company , finyear , finmonth,
	                                        yes_not, sectionnm, shift, lineno , statusday)
	                                values (p_card, p_secrete , v_start,   'A', p_com , p_year , p_month,
					                           0 , p_section, p_shift, p_line , 'W.Holiday');
	  else
	  update TB_DATA_MASTER_TEMP_ARCV
	  set   cardno      = p_card,
            secreteno   = p_secrete,
			pdate       =  v_start,
			intime      = '' ,
			outtime     = '',
			otstart     = '',
			duration    = '',
			latehr      = '',
			earlyhr     = '',
			otmin       = 0,
			otpart      = 0,
			latestatus  = '',
			earlystatus = '',
			company     = p_com,
			yes_not     = 0,
			isln        = 0,
			sectionnm   = p_section,
			shift       = p_shift,
			lineno      = p_line,
			finyear     = p_year,
			finmonth    = p_month,
			lateded     = 0,
			earlyded    = 0,
			othr        = 0,
			othrpart    = 0,
			psatus      = 'A',
			statusday   = 'W.Holiday'
	where  company    = p_com
    and    finyear    = p_year
    and    finmonth   = p_month
	and    sectionnm  = p_section
	and    lineno     = p_line
    and    pdate      = v_start
    and    cardno     = p_card;
	end if ;

    v_start := v_start + 1;

	end loop;
    commit;

    for c1rec in ( select b.cardno, b.secreteno, b.pdate, b.intime, b.outtime, b.otstart,
				          b.duration, b.latehr, b.earlyhr, b.otmin, b.otpart, b.latestatus,
						  b.earlystatus, b.company, b.yes_not, b.isln, b.sectionnm, b.shift,
						  b.lineno, b.finyear, b.finmonth, b.lateded, b.earlyded, b.othr,
						  b.othrpart, b.psatus, b.statusday
                   from  tb_data_master_temp b
	               where b.company  = p_com
				   and   b.finyear  = p_year
				   and   b.finmonth = p_month
				   and   b.sectionnm= p_section
	               and   b.lineno   = p_line
				   and   b.cardno   = p_card
				   order by b.pdate asc)
   loop

   update TB_DATA_MASTER_TEMP_ARCV
   set    cardno    = c1rec.cardno,
          secreteno = c1rec.secreteno,
		  pdate     = c1rec.pdate,
		  intime    = c1rec.intime ,
		  outtime   = c1rec.outtime,
		  otstart   = c1rec.otstart,
		  duration  = c1rec.duration,
		  latehr    = c1rec.latehr,
		  earlyhr   = c1rec.earlyhr,
		  otmin     = c1rec.otmin,
		  otpart    = c1rec.otpart,
		  latestatus  = c1rec.latestatus,
		  earlystatus = c1rec.earlystatus,
		  company   = c1rec.company,
		  yes_not   = c1rec.yes_not,
		  isln      = c1rec.isln,
		  sectionnm = c1rec.sectionnm,
		  shift     = c1rec.shift,
		  lineno    = c1rec.lineno,
		  finyear   = c1rec.finyear,
		  finmonth  = c1rec.finmonth,
		  lateded   = c1rec.lateded,
		  earlyded  = c1rec.earlyded,
		  othr      = c1rec.othr,
		  othrpart  = c1rec.othrpart,
		  psatus    = 'A',
		  statusday = statusday
   where  company   = p_com
   and    finyear   = p_year
   and    finmonth  = p_month
   and    sectionnm = p_section
   and    lineno    = p_line
   and    pdate     = c1rec.pdate
   and    cardno    = p_card;

   end loop;
   commit;

   for c2rec in ( select DURATION, OTMIN, OTPART, PDATE, INTIME, OUTTIME
                  from   tb_data_master_arcv
				  where  finyear   = p_year
				  and    finmonth  = p_month
				  and    company   = p_com
				  and    sectionnm = p_section
                  and    lineno    = p_line
				  and    cardno    = p_card
				  order by pdate asc)
   loop

   begin
   select count(*) into v_gholiday
   from   tb_month_generalholiday
   where  finyear   = p_year
   and    finmonth  = p_month
   and    c2rec.pdate between s_date and e_date;
   exception
   when no_data_found then v_gholiday :=0;
          when others then v_gholiday :=0;
   end;

   begin
   select count (*) into v_genday
   from   TB_MONTH_CONVERT_GENERALDAY
   where  company  = p_company
   and    finyear  = p_year
   and    finmonth = p_month
   and    WDAY     = v_wholiday
   and    c2rec.pdate between s_date and e_date;
   exception
   when no_data_found then v_genday := 0;
          when others then v_genday := 0;
   end;

   begin
   select count(*) into v_conday
   from   TB_MONTH_CONVERT_OTDAY
   where  company  = p_company
   and    finyear  = p_year
   and    finmonth = p_month
   and    c2rec.pdate between s_date and e_date;
   exception
   when no_data_found then v_conday := 0;
          when others then v_conday := 0;
   end;

   begin
   select count(*) into vv_cnt
   from   tb_leave_detailinfo
   where  company      = p_company
   and    finyear      = p_year
   and    finmonth     = p_month
   and    LEAVE_STATUS = 'Authorized'
   and    cardno       = p_card
   and    c2rec.pdate between start_date and end_date;
   exception
   when no_data_found then vv_cnt := 0;
          when others then vv_cnt := 0;
   end;

  if (c2rec.INTIME is not null or c2rec.OUTTIME is not null) then

	    if (v_gholiday > 0 and v_conday < 1) then
	        v_othr      := 0;
	        v_othrpart  := 0;
            v_status    := 'G';
            v_remark    := 'G.Holiday';

	      elsif  (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday < 1)  then

	        if p_otcom = 'N' then
			   v_othr      := 0;    v_othrpart  := 0;
			   else
		       v_othr      := round(c2rec.otmin/60);
		       v_othrpart  := 0;
			   end if;

			   v_status    := 'P';
			   v_remark    := 'Present';

	       elsif  (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday > 0) then

					   v_othr      := 0;
	                   v_othrpart  := 0;
					   v_status   := 'O';
					   v_remark   := 'G.Holiday';

           elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday > 0) then

					   v_othr      := 0;
	                   v_othrpart  := 0;
					   v_status    := 'O';
					   v_remark    := 'W.Holiday';

	         elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday < 1) then

					   v_othr      := 0;
	                   v_othrpart  := 0;
					   v_status   := 'O';
					   v_remark   := 'W.Holiday';

			   	 else
				 v_othr      := 0;
				 v_othrpart  := 0;
				 v_status    := 'A';
				 v_remark    := 'Absent';
				 end if;


	  elsif (c2rec.INTIME is null and c2rec.OUTTIME is null) then

		  if ((v_joinyear = p_year and v_joinmonth = p_month ) or (v_resgyear = p_year and v_resgmonth = p_month)) then

		     if (p_join_date > c2rec.pdate  or p_resign_date <= c2rec.pdate) then

		         v_othr      := 0;
			     v_othrpart  := 0;
		         v_status    := 'A';
		         v_remark    := 'Absent';

			     else

				  if (v_gholiday > 0 and v_conday < 1) then
				      v_othr      := 0;
				      v_othrpart  := 0;
				      v_status    := 'G';
				      v_remark    := 'G.Holiday';

			         elsif (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday < 1) then
						 	 v_othr      := 0;
							 v_othrpart  := 0;
							 v_status    := 'A';
							 v_remark    := 'Absent';

				       elsif (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday > 0) then
							 v_othr      := 0;
							 v_othrpart  := 0;
							 v_status    := 'A';
							 v_remark    := 'G.Holiday';

				       elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday > 0) then
							 v_othr      := 0;
							 v_othrpart  := 0;
							 v_status    := 'A';
							 v_remark    := 'W.Holiday';

		               elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday < 1) then
							 v_othr      := 0;
							 v_othrpart  := 0;
							 v_status    := 'A';
					     v_remark   := 'W.Holiday';
				       end if;
				    end if;

		   else

			 if (v_gholiday > 0 and v_conday < 1) then
			     v_othr      := 0;
				 v_othrpart  := 0;
				 v_status    := 'G';
				 v_remark    := 'G.Holiday';

			     elsif (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday < 1) then
						 v_othr      := 0;
						 v_othrpart  := 0;
						 v_status    := 'A';
						 v_remark    := 'Absent';

					   elsif (rtrim(to_char(c2rec.pdate,'Day')) <>  p_wholiday and v_conday > 0) then
							  v_othr      := 0;
							  v_othrpart  := 0;
							  v_status    := 'A';
							  v_remark    := 'G.Holiday';

						   elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday > 0) then
								  v_othr      := 0;
								  v_othrpart  := 0;
								  v_status    := 'A';
								  v_remark    := 'W.Holiday';

					          elsif (rtrim(to_char(c2rec.pdate,'Day')) =  p_wholiday and v_genday < 1) then
									 v_othr      := 0;
									 v_othrpart  := 0;
									 v_status    := 'A';
								     v_remark   := 'W.Holiday';
							      end if;
	                     end if;

	else

	v_othr      := 0;
	v_othrpart  := 0;
	v_status    := 'A';
	v_remark    := 'Absent';
    end if;


    if (vv_cnt >0 and rtrim(to_char(c2rec.pdate,'Day')) = p_wholiday and v_genday > 0)then
        v_status    := 'L';
	    v_remark    := 'Leave';

	  elsif (vv_cnt > 0 and rtrim(to_char(c2rec.pdate,'Day')) = p_wholiday and v_genday < 1)then
      v_status    := 'L';
	  v_remark    := 'W.Holiday';

	  elsif (vv_cnt > 0 and rtrim(to_char(c2rec.pdate,'Day')) <> p_wholiday and v_gholiday < 1 and v_conday < 1) then
	  v_status    := 'L';
	  v_remark    := 'Leave';

	  elsif (vv_cnt > 0 and rtrim(to_char(c2rec.pdate,'Day')) <> p_wholiday and v_gholiday > 0 and v_conday < 1) then
	  v_status    := 'L';
	  v_remark    := 'G.Holiday';

	  elsif (vv_cnt > 0 and rtrim(to_char(c2rec.pdate,'Day')) <> p_wholiday and v_gholiday > 0 and v_conday > 0) then
	  v_status    := 'L';
	  v_remark    := 'G.Holiday';

	  else
	  v_status    := v_status;
	  v_remark    := v_remark;
	  end if;


		update TB_DATA_MASTER_TEMP_ARCV
		set    othr     = v_othr,
		       othrpart = v_othrpart,
		       psatus   = v_status,
			   statusday= v_remark
	    where  company  = p_com
		and    pdate    = c2rec.pdate
		and    cardno   = p_card
		and    finyear  = p_year
	    and    sectionnm= p_section
        and    lineno   = p_line
		and    finmonth = p_month;

	  end loop;
	  commit;



exception
 when no_data_found then null;
 when others then null;
end;
/

